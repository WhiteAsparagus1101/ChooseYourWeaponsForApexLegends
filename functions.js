const weapons = [{
    "name": "HAVOC Rifle",
    "ammo": "Energy",
    "weapon_type": "MR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"],
        "hop_up": ["none", "Turbocharger"]
    },
    "supply_drop": false
},
{
    "name": "VK-47 Flatline",
    "ammo": "Heavy",
    "weapon_type": "AR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false,
},
{
    "name": "Hemlok Burst AR",
    "ammo": "Heavy",
    "weapon_type": "AR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"],
        "hop_up": ["none", "Boosted Loader"]
    },
    "supply_drop": false
},
{
    "name": "R-301 Carbine",
    "ammo": "Light",
    "weapon_type": "AR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "Alternator SMG",
    "ammo": "Light",
    "weapon_type": "SMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false,
},
{
    "name": "Prowler Burst PDW",
    "ammo": "Heavy",
    "weapon_type": "SMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "R-99 SMG",
    "ammo": "Heavy",
    "weapon_type": "SMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "Volt SMG",
    "ammo": "Energy",
    "weapon_type": "SMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        // "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        // "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        // "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": true
},
{
    "name": "C.A.R. SMG",
    "ammo": "Heavy",
    "weapon_type": "SMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "Devotion LMG",
    "ammo": "Energy",
    "weapon_type": "LMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"],
        "hop_up": ["none", "Turbocharger"]
    },
    "supply_drop": false
},
{
    "name": "L-STAR EMG",
    "ammo": "Energy",
    "weapon_type": "LMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "M600 Spitfire",
    "ammo": "Heavy",
    "weapon_type": "LMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "Rampage LMG",
    "ammo": "Heavy",
    "weapon_type": "LMG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "standard_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "G7 Scout",
    "ammo": "Light",
    "weapon_type": "MR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"]
    },
    "supply_drop": true
},
{
    "name": "Triple Take",
    "ammo": "Energy",
    "weapon_type": "MR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "sniper_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "30-30 Repeater",
    "ammo": "Heavy",
    "weapon_type": "MR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\"", "2x-4x Variable AOG"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "sniper_stock": ["none", "Level1", "Level2", "Level3"],
        "hop_up": ["none", "Shatter Caps"]
    },
    "supply_drop": false
},
{
    "name": "Bocek Compound Bow",
    "ammo": "Arrow",
    "weapon_type": "MR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "3x HCOG \"Ranger\""],
        "hop_up": ["none", "Deadeye's Tempo", "Shatter Caps"]
    },
    "supply_drop": false
},
{
    "name": "Charge Rifle",
    "ammo": "Sniper",
    "weapon_type": "SR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "6x Sniper", "3x HCOG \"Ranger\"", "2x-4x Variable AOG", "4x-8x Variable Sniper", "4x-10x Digital Sniper Threat"],
        "sniper_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "Longbow DMR",
    "ammo": "Sniper",
    "weapon_type": "SR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "6x Sniper", "3x HCOG \"Ranger\"", "2x-4x Variable AOG", "4x-8x Variable Sniper", "4x-10x Digital Sniper Threat"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "sniper_stock": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "Kraber .50-Cal Sniper",
    "ammo": "Sniper",
    "weapon_type": "SR",
    "attachments": {},
    "supply_drop": true
},
{
    "name": "Sentinel",
    "ammo": "Sniper",
    "weapon_type": "SR",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "6x Sniper", "3x HCOG \"Ranger\"", "2x-4x Variable AOG", "4x-8x Variable Sniper", "4x-10x Digital Sniper Threat"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "sniper_stock": ["none", "Level1", "Level2", "Level3"],
        "hop_up": ["none", "Deadeye's Tempo"]
    },
    "supply_drop": false
},
{
    "name": "EVA-8 Auto",
    "ammo": "Shotgun",
    "weapon_type": "SG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "shotgun_bolt": ["none", "Level1", "Level2", "Level3"]
    },
    "supply_drop": false
},
{
    "name": "Mastiff Shotgun",
    "ammo": "Shotgun",
    "weapon_type": "SG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        // "shotgun_bolt": ["none", "Level1", "Level2", "Level3"],
        // "hop_up": ["none", "Dual Shell"]
    },
    "supply_drop": true
},
{
    "name": "Mozambique Shotgun",
    "ammo": "Shotgun",
    "weapon_type": "SG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "shotgun_bolt": ["none", "Level1", "Level2", "Level3"],
        "hop_up":["none", "Hammerpoints Rounds"]

    },
    "supply_drop": false
},
{
    "name": "Peacekeeper",
    "ammo": "Shotgun",
    "weapon_type": "SG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "shotgun_bolt": ["none", "Level1", "Level2", "Level3"],
        "hop_up":["none", "Kinetic Feeder"]
    },
    "supply_drop": false
},
{
    "name": "RE-45 Auto",
    "ammo": "Light",
    "weapon_type": "HG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "barrel_stabilizer": ["none", "Level1", "Level2", "Level3"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "hop_up":["none", "Hammerpoints Rounds"]
    },
    "supply_drop": false
},
{
    "name": "P2020",
    "ammo": "Light",
    "weapon_type": "HG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "hop_up":["none", "Hammerpoints Rounds"]
    },
    "supply_drop": false
},
{
    "name": "Wingman",
    "ammo": "Heavy",
    "weapon_type": "HG",
    "attachments": {
        "optic": ["none", "1x HCOG \"Classic\"", "1x Holo", "2x HCOG \"Bruiser\"", "1x-2x Variable Holo", "1x Digital Threat"],
        "extended_mag": ["none", "Level1", "Level2", "Level3", "Level4"],
        "hop_up": ["none", "Boosted Loader"]
    },
    "supply_drop": false
}
];


function chooseAndDisplay() {
    let filterdWeapons = filtering(weapons.slice());
    let results = chooseWeapons(filterdWeapons);
    displayWeapons(results);
}

function filtering(hairetsu) {
    let filteredArray = hairetsu;

    // サプライドロップふるいにかけてる
    let includeSupplyDrop = document.getElementById("supply_drop").checked;
    if (includeSupplyDrop == false) {
        filteredArray = filteredArray.filter(w => w["supply_drop"] == false);
    }


    // Ammoふるいをかける
    let ammoChecks = document.getElementById("Ammo").children;
    let ammoCheckedList = [];
    for (let r of ammoChecks) {
        let checkBox = r.children[0];
        if (checkBox.checked == true) {
            console.log("checked")
            ammoCheckedList.push(checkBox.name);
        }
    }
    filteredArray = filteredArray.filter(w => ammoCheckedList.includes(w["ammo"]));


    // weapon typeふるいをかける
    let weaponTypeChecks = document.getElementById("Weapon Type").children;
    let weaponTypeCheckedList = [];
    for (let r of weaponTypeChecks) {
        let checkBox = r.children[0];
        if (checkBox.checked == true) {
            console.log("checked")
            weaponTypeCheckedList.push(checkBox.name);
        }
    }
    filteredArray = filteredArray.filter(w => weaponTypeCheckedList.includes(w["weapon_type"]));



    console.log(filteredArray);

    return filteredArray;
}





function displayWeapons(results) {
    // 結果表示
    // console.log(results);
    let display = "";

    if (results.length == 2) {
        for (let i = 0; i < 2; i++) {
            let res = results[i];
            display += `<h2>Weapon${i + 1}</h2><table><thead><tr><th>${res["name"]}</th></tr></thead><tbody>`;
            for (const [key, value] of Object.entries(res["attachments"])) {
                display += `<tr><td>${key}</td><td>${value}</td></tr>`
            }
            display += "</tbody></table>"
        }
    }else{
        display = "<p style=\"color:red;font-size:60px;\">There is no candidate of weapons.</p>"
    }

    let d1 = document.getElementById("results");
    d1.innerHTML = display;

}


function chooseWeapons(filterdWeapons) {
    // 武器を2つ選んでる
    let results = [];

    if (filterdWeapons.length != 0) {
        for (let i = 0; i < 2; i++) {
            let result = {};
            let random_number = Math.floor(Math.random() * filterdWeapons.length);
            let weapon = filterdWeapons[random_number];

            result["name"] = weapon["name"];

            let attach = {};
            for (const [key, value] of Object.entries(weapon["attachments"])) {
                attach[key] = value[Math.floor(Math.random() * value.length)];
            }
            result["attachments"] = attach;

            results.push(result);
        }
    }

    return results;

}



window.addEventListener("load", () => {
    let btn = document.getElementById("b1");
    btn.addEventListener("click", chooseAndDisplay, false);
})